<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compra de Bilhetes - Artifacts Emporium</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/Tp.css">
    <style>
        .museum-card {
            cursor: pointer;
        }
        .museum-card:hover {
            transform: scale(1.05);
        }
        .museum-card img {
            height: 200px;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <header class="p-3 text-bg-dark">
        <div class="container-fluid">
            <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
                <a href="index.html" class="d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none">
                    <svg class="bi me-2" width="40" height="32" role="img" aria-label="Bootstrap"><use xlink:href="#bootstrap"/></svg>
                </a>
                <div class="titulo"><h1>Artifacts Emporium</h1></div>
                <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
                    <li><a href="index.html" class="nav-link px-2 text-secondary">Home</a></li>
                    <li><a href="quemsomos.html" class="nav-link px-2 text-white">Quem Somos</a></li>
                    <li><a href="osnossosmuseus.html" class="nav-link px-2 text-white">Os Nossos Museus</a></li>
                    <li><a href="eventos.html" class="nav-link px-2 text-white">Eventos</a></li>
                    <li><a href="bilhetes.html" class="nav-link px-2 text-white">Bilhetes</a></li>
                </ul>
                
                <form class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-3 d-flex" role="search"> 
                    <button class="btn btn-dark"><img src="images/searchbar.png" alt="search" height="30px"></button> 
                    <input type="search" class="form-control form-control-dark text-bg-dark" placeholder="Search..." aria-label="Search">
                </form>
    
                <div class="text-end">
                    <a class="btn btn-dark" href="bilhetes.html"><img src="images/pt-button-01.png" alt="PT" height="38px"> PT</a>
                    <a class="btn btn-dark" href="bilheetesEng.html"><img src="images/uk-button-01.png" alt="UK" height="38px"> Eng</a>
                </div>
            </div>
        </div>
    </header>

    <div class="container mt-4">
        <div class="row" id="museumCardsContainer">
            <!-- Os cards dos museus serão gerados aqui dinamicamente -->
        </div>
    </div>

    <footer class="bg-light py-4 mt-5">
        <div class="container text-center">
            &copy; 2024 Artifacts Emporium. Todos os direitos reservados.
        </div>
    </footer>

    <script src="js/bootstrap.bundle.js"></script>
    <script>
document.addEventListener('DOMContentLoaded', function() {
    fetch('http://localhost:3000/get-museums')
        .then(response => response.json())
        .then(data => {
            const museumCardsContainer = document.getElementById('museumCardsContainer');

            // Verifica se 'data.data' é um array antes de iterar sobre ele
            if (Array.isArray(data.data)) {
                // Ordena os museus pelo pk_id_museu
                const sortedMuseums = data.data.sort((a, b) => a.pk_id_museu - b.pk_id_museu);

                // Função auxiliar para criar e adicionar um card ao container
                const addMuseumCard = (museum) => {
                    // Busca os bilhetes correspondentes ao museu atual, filtrando apenas os bilhetes do tipo normal
                    fetch(`http://localhost:3000/get-tickets/${museum.pk_id_museu}`)
                        .then(response => response.json())
                        .then(responseData => {
                            // Verifica se a resposta é válida e se contém a propriedade 'data'
                            if (responseData && responseData.message === 'success' && Array.isArray(responseData.data)) {
                                const normalTickets = responseData.data.filter(ticket => ticket.tipo === 'normal');

                                // Cria um card para o museu com base nos bilhetes do tipo normal obtidos
                                const card = document.createElement('div');
                                card.className = 'col-md-4 mb-4';
                                card.innerHTML = `
                                    <a href="comprabilhetes.html?museu=${museum.pk_id_museu}" class="text-decoration-none">
                                        <div class="card museum-card" data-museum="${museum.nome}">
                                            <img src="${museum.imagem}" class="card-img-top" alt="${museum.nome}">
                                            <div class="card-body">
                                                <h5 class="card-title">${museum.nome}</h5>
                                                <p class="card-text">Bilhetes normais disponíveis:</p>
                                                <ul>
                                                    ${normalTickets.map(ticket => `<li>Valor: $${ticket.preco}</li>`).join('')}
                                                </ul>
                                            </div>
                                        </div>
                                    </a>`;

                                // Adiciona o card ao container na ordem correta
                                museumCardsContainer.appendChild(card);
                            } else {
                                console.error('Resposta inválida ou dados de bilhetes ausentes:', responseData);
                            }
                        })
                        .catch(error => {
                            console.error('Erro ao buscar bilhetes:', error);
                        });
                };

                // Adiciona os cards na ordem dos museus ordenados
                sortedMuseums.forEach(museum => {
                    addMuseumCard(museum);
                });
            } else {
                console.error('Dados retornados não contêm um array de museus:', data);
            }
        })
        .catch(error => {
            console.error('Erro ao buscar museus:', error);
        });
});


    </script>
    <script src="js/search.js"></script>
</body>
</html>
